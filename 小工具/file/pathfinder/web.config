<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        <staticContent>
            <remove fileExtension=".pdf" />
            <mimeMap fileExtension=".pdf" mimeType="application/pdf" />
        </staticContent>
        <rewrite>
            <outboundRules>
                <!-- 规则1：默认情况下（无参数）设置inline -->
                <rule name="DefaultInline" preCondition="IsPDF">
                    <match serverVariable="RESPONSE_Content_Disposition" pattern=".*" />
                    <conditions logicalGrouping="MatchAll">
                        <add input="{QUERY_STRING}" pattern=".*download.*" negate="true" />
                    </conditions>
                    <action type="Rewrite" value="inline" />
                </rule>
                
                <!-- 规则2：有download参数时设置attachment -->
                <rule name="ForceDownload" preCondition="IsPDF">
                    <match serverVariable="RESPONSE_Content_Disposition" pattern=".*" />
                    <conditions>
                        <add input="{QUERY_STRING}" pattern=".*download.*" />
                    </conditions>
                    <action type="Rewrite" value="attachment" />
                </rule>
                
                <!-- 规则3：有preview参数时确保inline（可选） -->
                <rule name="EnsurePreview" preCondition="IsPDF">
                    <match serverVariable="RESPONSE_Content_Disposition" pattern=".*" />
                    <conditions>
                        <add input="{QUERY_STRING}" pattern=".*preview.*" />
                    </conditions>
                    <action type="Rewrite" value="inline" />
                </rule>
                
                <preConditions>
                    <preCondition name="IsPDF">
                        <add input="{PATH_INFO}" pattern="\.pdf$" />
                    </preCondition>
                </preConditions>
            </outboundRules>
        </rewrite>
    </system.webServer>
</configuration>
